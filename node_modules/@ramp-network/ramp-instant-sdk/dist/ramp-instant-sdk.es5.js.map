{"version":3,"file":"ramp-instant-sdk.es5.js","sources":["../node_modules/body-scroll-lock/lib/bodyScrollLock.min.js","../src/consts.ts","../src/event-polling.ts","../src/types.ts","../src/init-helpers.ts","../src/utils.ts","../src/ramp-instant-sdk.ts"],"sourcesContent":["!function(e,t){if(\"function\"==typeof define&&define.amd)define([\"exports\"],t);else if(\"undefined\"!=typeof exports)t(exports);else{var o={};t(o),e.bodyScrollLock=o}}(this,function(exports){\"use strict\";function r(e){if(Array.isArray(e)){for(var t=0,o=Array(e.length);t<e.length;t++)o[t]=e[t];return o}return Array.from(e)}Object.defineProperty(exports,\"__esModule\",{value:!0});var l=!1;if(\"undefined\"!=typeof window){var e={get passive(){l=!0}};window.addEventListener(\"testPassive\",null,e),window.removeEventListener(\"testPassive\",null,e)}var d=\"undefined\"!=typeof window&&window.navigator&&window.navigator.platform&&/iP(ad|hone|od)/.test(window.navigator.platform),c=[],u=!1,a=-1,s=void 0,v=void 0,f=function(t){return c.some(function(e){return!(!e.options.allowTouchMove||!e.options.allowTouchMove(t))})},m=function(e){var t=e||window.event;return!!f(t.target)||(1<t.touches.length||(t.preventDefault&&t.preventDefault(),!1))},o=function(){setTimeout(function(){void 0!==v&&(document.body.style.paddingRight=v,v=void 0),void 0!==s&&(document.body.style.overflow=s,s=void 0)})};exports.disableBodyScroll=function(i,e){if(d){if(!i)return void console.error(\"disableBodyScroll unsuccessful - targetElement must be provided when calling disableBodyScroll on IOS devices.\");if(i&&!c.some(function(e){return e.targetElement===i})){var t={targetElement:i,options:e||{}};c=[].concat(r(c),[t]),i.ontouchstart=function(e){1===e.targetTouches.length&&(a=e.targetTouches[0].clientY)},i.ontouchmove=function(e){var t,o,n,r;1===e.targetTouches.length&&(o=i,r=(t=e).targetTouches[0].clientY-a,!f(t.target)&&(o&&0===o.scrollTop&&0<r?m(t):(n=o)&&n.scrollHeight-n.scrollTop<=n.clientHeight&&r<0?m(t):t.stopPropagation()))},u||(document.addEventListener(\"touchmove\",m,l?{passive:!1}:void 0),u=!0)}}else{n=e,setTimeout(function(){if(void 0===v){var e=!!n&&!0===n.reserveScrollBarGap,t=window.innerWidth-document.documentElement.clientWidth;e&&0<t&&(v=document.body.style.paddingRight,document.body.style.paddingRight=t+\"px\")}void 0===s&&(s=document.body.style.overflow,document.body.style.overflow=\"hidden\")});var o={targetElement:i,options:e||{}};c=[].concat(r(c),[o])}var n},exports.clearAllBodyScrollLocks=function(){d?(c.forEach(function(e){e.targetElement.ontouchstart=null,e.targetElement.ontouchmove=null}),u&&(document.removeEventListener(\"touchmove\",m,l?{passive:!1}:void 0),u=!1),c=[],a=-1):(o(),c=[])},exports.enableBodyScroll=function(t){if(d){if(!t)return void console.error(\"enableBodyScroll unsuccessful - targetElement must be provided when calling enableBodyScroll on IOS devices.\");t.ontouchstart=null,t.ontouchmove=null,c=c.filter(function(e){return e.targetElement!==t}),u&&0===c.length&&(document.removeEventListener(\"touchmove\",m,l?{passive:!1}:void 0),u=!1)}else(c=c.filter(function(e){return e.targetElement!==t})).length||o()}});\n","export const baseWidgetUrl = 'https://widget-instant.ramp.network';\n","import { IPurchase } from './types';\n\n\nexport async function doFetchPurchase(\n  apiUrl: string,\n  purchaseId: number,\n  token: string\n): Promise<IPurchase | null> {\n  try {\n    const rawResponse = await fetch(\n      `${apiUrl}/host-api/purchase/${purchaseId}?secret=${token}`,\n      {\n        headers: {\n          'Content-Type': 'application/json'\n        }\n      }\n    );\n\n    if (!rawResponse.ok) {\n      throw new Error(`Request for purchase #${purchaseId} failed`);\n    }\n\n    const response = await rawResponse.json();\n\n    return response as IPurchase;\n  } catch {\n    return null;\n  }\n}\n\nexport async function delay(ms: number): Promise<void> {\n  return new Promise(resolve => setTimeout(resolve, ms));\n}\n","type TAsset = string;\ntype TEthAddress = string;\ntype TSwapAmount = string;\ntype THostLogoUrl = string;\ntype THostApiKey = string;\ntype THostAppName = string;\ntype TURL = string;\ntype TPurchaseID = number;\ntype TDateString = string;\ntype TFiatCurrency = string;\ntype TFiatValue = string;\ntype TAddress = string;\ntype TEmailAddress = string;\ntype TCryptoAmount = string;\ntype TPoolFee = number;\ntype TRampFee = number;\ntype TAssetExchangeRate = number;\ntype TPurchaseHash = string;\ntype TActionID = string;\ntype TNewActionStatus = string;\ntype TActionTimestamp = string;\ntype TActionDetails = string;\ntype TWebhookStatusUrl = string;\n\nexport interface IHostConfig {\n  swapAsset?: TAsset;\n  swapAmount?: TSwapAmount;\n  userAddress?: TEthAddress;\n  userEmailAddress?: TEmailAddress;\n  // Shhh, top secret & undocumented stuff\n  hostApiKey?: THostApiKey;\n  hostLogoUrl: THostLogoUrl;\n  hostAppName: THostAppName;\n  url?: TURL;\n  variant?: WidgetVariantTypes | 'auto';\n  webhookStatusUrl?: TWebhookStatusUrl;\n}\n\nexport interface IPurchasePollingCredentials {\n  token: string;\n  apiUrl: string;\n  purchaseId: number;\n}\n\nexport interface IHostConfigWithWidgetInstanceId extends IHostConfig {\n  widgetInstanceId: string;\n  variant: WidgetVariantTypes;\n}\n\nexport interface IAssetInfo {\n  address: string | null;\n  symbol: string;\n  name: string;\n  decimals: number;\n}\n\nexport interface IPurchase {\n  id: TPurchaseID;\n  endTime: TDateString | null;\n  /** @deprecated use `asset.address` */\n  tokenAddress: TAddress | null;\n  asset: IAssetInfo;\n  escrowAddress?: TAddress;\n  receiverAddress: TAddress;\n  cryptoAmount: TCryptoAmount;\n  /** @deprecated use `cryptoAmount` */\n  ethAmount?: TCryptoAmount;\n  /** @deprecated use `cryptoAmount` */\n  tokenAmount?: TCryptoAmount;\n  fiatCurrency: TFiatCurrency;\n  fiatValue: TFiatValue;\n  assetExchangeRate: TAssetExchangeRate;\n  poolFee: TPoolFee;\n  rampFee: TRampFee;\n  purchaseHash: TPurchaseHash;\n  actions: IAction[];\n}\n\nexport interface IAction {\n  id: TActionID;\n  newStatus: TNewActionStatus;\n  timestamp: TActionTimestamp;\n  details: TActionDetails;\n}\n\nexport enum EventSeverity {\n  VERBOSE = 'VERBOSE',\n  DEBUG = 'DEBUG',\n  INFO = 'INFO',\n  WARNING = 'WARNING',\n  ERROR = 'ERROR',\n  CRITICAL = 'CRITICAL'\n}\n\nexport interface IConfigError {\n  fieldName: string;\n  description: string;\n  exampleValue?: string;\n  severity: EventSeverity;\n}\n\nexport interface IWidgetEvent {\n  type: string;\n  payload: any | null;\n  internal?: boolean;\n}\n\nexport enum WidgetEventTypes {\n  WIDGET_CLOSE = 'WIDGET_CLOSE',\n  WIDGET_CONFIG_DONE = 'WIDGET_CONFIG_DONE',\n  PURCHASE_CREATED = 'PURCHASE_CREATED',\n  PURCHASE_SUCCESSFUL = 'PURCHASE_SUCCESSFUL',\n  PURCHASE_FAILED = 'PURCHASE_FAILED'\n}\n\nexport enum InternalEventTypes {\n  WIDGET_CLOSE_REQUEST = 'WIDGET_CLOSE_REQUEST',\n  WIDGET_CLOSE_REQUEST_CANCELLED = 'WIDGET_CLOSE_REQUEST_CANCELLED',\n  WIDGET_CLOSE_REQUEST_CONFIRMED = 'WIDGET_CLOSE_REQUEST_CONFIRMED'\n}\n\nexport type TAllEventTypes = WidgetEventTypes | InternalEventTypes;\n\nexport interface IWidgetCloseEvent extends IWidgetEvent {\n  type: WidgetEventTypes.WIDGET_CLOSE;\n  payload: null;\n  widgetInstanceId: string;\n  internal?: false;\n}\n\nexport interface IPurchaseCreatedEvent extends IWidgetEvent {\n  type: WidgetEventTypes.PURCHASE_CREATED;\n  payload: {\n    purchase: IPurchase;\n    purchaseViewToken: string;\n    apiUrl: string;\n  };\n  widgetInstanceId: string;\n  internal?: false;\n}\n\nexport interface IPurchaseSuccessfulEvent extends IWidgetEvent {\n  type: WidgetEventTypes.PURCHASE_SUCCESSFUL;\n  payload: {\n    purchase: IPurchase;\n  };\n  widgetInstanceId: string;\n  internal?: false;\n}\n\nexport interface IPurchaseFailedEvent extends IWidgetEvent {\n  type: WidgetEventTypes.PURCHASE_FAILED;\n  payload: null;\n  widgetInstanceId: string;\n  internal?: false;\n}\n\nexport interface IWidgetConfigDoneEvent extends IWidgetEvent {\n  type: WidgetEventTypes.WIDGET_CONFIG_DONE;\n  payload: null;\n  widgetInstanceId: string;\n  internal?: false;\n}\n\nexport interface IWidgetCloseRequestEvent extends IWidgetEvent {\n  type: InternalEventTypes.WIDGET_CLOSE_REQUEST;\n  payload: null;\n  widgetInstanceId?: string;\n  internal: boolean;\n}\n\nexport interface IWidgetCloseRequestCancelledEvent extends IWidgetEvent {\n  type: InternalEventTypes.WIDGET_CLOSE_REQUEST_CANCELLED;\n  payload: null;\n  internal: true;\n}\n\nexport interface IWidgetCloseRequestConfirmedEvent extends IWidgetEvent {\n  type: InternalEventTypes.WIDGET_CLOSE_REQUEST_CONFIRMED;\n  payload: null;\n  internal: true;\n}\n\nexport type TWidgetEvents =\n  | IWidgetCloseEvent\n  | IWidgetConfigDoneEvent\n  | IPurchaseCreatedEvent\n  | IPurchaseFailedEvent\n  | IPurchaseSuccessfulEvent;\n\nexport type TInternalEvents =\n  | IWidgetCloseRequestEvent\n  | IWidgetCloseRequestCancelledEvent\n  | IWidgetCloseRequestConfirmedEvent;\n\nexport type TAllEvents = TWidgetEvents | TInternalEvents;\n\nexport type WidgetVariantTypes = 'desktop' | 'mobile';\n\nexport type TUnsubscribeToken = string;\n\nexport type TEventListenerDict = {\n  [EventType in TAllEvents['type']]: IEventListener[];\n};\n\nexport interface IEventListener {\n  internal: boolean;\n  callback(evt: TAllEvents): any;\n}\n","import { baseWidgetUrl } from './consts';\nimport {\n  IHostConfigWithWidgetInstanceId,\n  InternalEventTypes,\n  TAllEvents,\n  WidgetVariantTypes\n} from './types';\n\nexport function initWidgetIframeUrl(config: IHostConfigWithWidgetInstanceId): string {\n  const baseUrl = new URL(config.url || baseWidgetUrl);\n  const hostUrl = window.location.origin;\n\n  const { url, ...configWithoutIframeUrl } = config;\n\n  const preparedConfig = { ...configWithoutIframeUrl, hostUrl };\n\n  Object.entries(preparedConfig).forEach(([key, value]) => {\n    if (value) {\n      baseUrl.searchParams.append(key, value);\n    }\n  });\n\n  return baseUrl.toString();\n}\n\nexport function initDOMNode(\n  url: string,\n  dispatch: (event: TAllEvents) => void,\n  config: IHostConfigWithWidgetInstanceId\n): {\n  body: HTMLBodyElement | null;\n  iframe: HTMLIFrameElement;\n  overlay: HTMLDivElement;\n  shadow: ShadowRoot;\n  shadowHost: HTMLDivElement;\n} {\n  const body = document.querySelector('body');\n\n  const shadowHost = document.createElement('div');\n\n  const shadow = shadowHost.attachShadow({ mode: 'open' });\n\n  shadow.appendChild(getStylesForShadowDom(config.variant));\n\n  const iframe = prepareIframeNode(url, config.variant);\n  const overlay = prepareOverlayNode(iframe, dispatch);\n\n  overlay.appendChild(iframe);\n  shadow.appendChild(overlay);\n\n  return {\n    body,\n    iframe,\n    overlay,\n    shadow,\n    shadowHost\n  };\n}\n\nexport function importFonts(): void {\n  if (document.querySelector('[data-ramp-font]')) {\n    return;\n  }\n\n  const font = document.createElement('link');\n\n  font.setAttribute(\n    'href',\n    'https://fonts.googleapis.com/css?family=Poppins:200,400,500,600,700&display=swap&subset=latin-ext'\n  );\n  font.setAttribute('rel', 'stylesheet');\n  font.setAttribute('data-ramp-font', '');\n\n  document.head.appendChild(font);\n}\n\nfunction prepareIframeNode(url: string, variant: WidgetVariantTypes): HTMLIFrameElement {\n  const iframe = document.createElement('iframe');\n\n  iframe.setAttribute('src', url);\n\n  iframe.setAttribute('width', variant === 'desktop' ? '895' : window.innerWidth.toString());\n\n  iframe.setAttribute('height', variant === 'desktop' ? '590' : window.innerHeight.toString());\n\n  iframe.classList.add('iframe');\n\n  return iframe;\n}\n\nfunction prepareOverlayNode(\n  iframe: HTMLIFrameElement,\n  dispatch: (event: TAllEvents) => void\n): HTMLDivElement {\n  const overlay = document.createElement('div');\n\n  overlay.classList.add('overlay');\n\n  const loader = document.createElement('div');\n  loader.classList.add('loader-container');\n\n  // tslint:disable-next-line:max-line-length\n  loader.innerHTML = `<svg width=\"92\" height=\"60\" viewBox=\"0 0 46 30\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\" class=\"loader\"><path d=\"M15.0061 17.654L21.5635 24.2138L16.3269 29.4524C15.597 30.1825 14.4037 30.1825 13.6738 29.4524L0.547415 16.3212C-0.182472 15.5911 -0.182472 14.3973 0.547415 13.6672L13.6738 0.547614C14.4037 -0.182538 15.597 -0.182538 16.3269 0.547614L21.5635 5.78617L15.0061 12.346C13.5463 13.8063 13.5463 16.1937 15.0061 17.654Z\" fill=\"#56BE89\"></path><path d=\"M45.4243 16.3212L32.2979 29.4524C31.568 30.1825 30.3747 30.1825 29.6448 29.4524L24.4082 24.2138L30.9656 17.654C32.4254 16.1937 32.4254 13.8178 30.9656 12.346L24.4082 5.78617L29.6448 0.547614C30.3747 -0.182538 31.568 -0.182538 32.2979 0.547614L45.4243 13.6788C46.1542 14.4089 46.1542 15.5911 45.4243 16.3212Z\" fill=\"#31335D\"></path><path d=\"M29.4532 16.321L22.8958 22.8808L16.3384 16.321C15.6085 15.5909 15.6085 14.3971 16.3384 13.667L22.8958 7.10718L29.4532 13.667C30.1831 14.4087 30.1831 15.5909 29.4532 16.321Z\" fill=\"#56BE89\"></path></svg>`;\n\n  overlay.appendChild(loader);\n\n  overlay.addEventListener('click', event => {\n    if (event.target !== iframe && !overlay.querySelectorAll('.close-modal').length) {\n      dispatch({\n        type: InternalEventTypes.WIDGET_CLOSE_REQUEST,\n        payload: null,\n        internal: true\n      });\n    }\n  });\n\n  return overlay;\n}\n\nexport function areUrlsEqual(url0: string, url1: string): boolean {\n  return new URL(url0).toString() === new URL(url1).toString();\n}\n\nexport function isCloseModalAlreadyOpen(containerNode: HTMLElement): boolean {\n  return containerNode.querySelectorAll('.close-modal').length !== 0;\n}\n\nexport function prepareCloseModalNode(dispatch: (event: TAllEvents) => void): HTMLDivElement {\n  const container = document.createElement('div');\n  container.classList.add('close-modal');\n\n  const textEl = document.createElement('div');\n  textEl.classList.add('close-modal__text');\n  textEl.textContent = 'Are you sure you want to exit Ramp Instant and abandon the transaction?';\n\n  const buttonContainer = document.createElement('div');\n  buttonContainer.classList.add('close-modal__button-container');\n\n  const cancelButton = document.createElement('button');\n  cancelButton.setAttribute('type', 'button');\n  cancelButton.classList.add('close-modal__button');\n  cancelButton.classList.add('close-modal__button--cancel');\n  cancelButton.textContent = 'Cancel';\n  cancelButton.addEventListener('click', event => {\n    event.stopPropagation();\n\n    dispatch({\n      type: InternalEventTypes.WIDGET_CLOSE_REQUEST_CANCELLED,\n      payload: null,\n      internal: true\n    });\n  });\n\n  const exitButton = document.createElement('button');\n  exitButton.setAttribute('type', 'button');\n  exitButton.classList.add('close-modal__button');\n  exitButton.classList.add('close-modal__button--exit');\n  exitButton.textContent = 'Exit';\n  exitButton.addEventListener('click', event => {\n    event.stopPropagation();\n\n    dispatch({\n      type: InternalEventTypes.WIDGET_CLOSE_REQUEST_CONFIRMED,\n      payload: null,\n      internal: true\n    });\n  });\n\n  buttonContainer.appendChild(cancelButton);\n  buttonContainer.appendChild(exitButton);\n\n  container.appendChild(textEl);\n  container.appendChild(buttonContainer);\n\n  return container;\n}\n\nfunction getStylesForShadowDom(variant: WidgetVariantTypes): HTMLStyleElement {\n  const styles = document.createElement('style');\n\n  const isMobile = variant === 'mobile';\n\n  styles.textContent = `\n    .overlay {\n      position: fixed;\n      z-index: 1000;\n      width: 100vw;\n      height: 100vh;\n      top: 0;\n      left: 0;\n      background-color: rgba(166, 174, 185, 0.7);\n      display: flex;\n      flex-flow: row nowrap;\n      justify-content: center;\n      ${isMobile ? 'align-items: flex-start;' : 'align-items: center;'}\n    }\n\n    .loader-container {\n      align-self: center;\n    }\n\n    .loader {\n      transform-origin: center;\n      animation: logoAnimation 4s linear infinite;\n      width: 100px;\n      height: auto;\n      align-self: center;\n    }\n\n    .loader path:nth-child(3) {\n      transform-origin: center;\n      position: relative;\n    }\n\n    .loader path:nth-child(1) {\n      transform-origin: center;\n      position: relative;\n      animation: box1Animation 4s linear infinite;\n      transform: scale(0.4) translateX(6px);\n    }\n\n    .loader path:nth-child(2) {\n      transform-origin: center;\n      position: relative;\n      animation: box4Animation 4s linear infinite;\n      transform: scale(0.4) translateX(-6px);\n    }\n\n    @keyframes logoAnimation {\n      10% {\n        transform: rotate(180deg);\n      }\n      30%{\n        transform: rotate(360deg);\n      }\n      70% {\n        transform: rotate(360deg);\n      }\n      90% {\n        transform: rotate(520deg);\n      }\n      100% {\n        transform: rotate(720deg);\n      }\n    }\n\n    @keyframes box1Animation {\n      0%, 10% {\n        transform: scale(0.4) translateX(6px);\n      }\n      30%, 70% {\n        transform: scale(1) translateX(0);\n      }\n      90% {\n        transform: scale(0.4) translateX(6px);\n      }\n    }\n\n\n    @keyframes box4Animation {\n      0%, 10% {\n        transform: scale(0.4) translateX(-6px);\n      }\n      30%, 70% {\n        transform: scale(1) translateX(0);\n      }\n      90% {\n        transform: scale(0.4) translateX(-6px);\n      }\n    }\n\n    .iframe {\n      border: none;\n      user-select: none;\n      visibility: hidden;\n      position: absolute;\n    }\n\n    .iframe.visible {\n      visibility: visible;\n      position: unset;\n    }\n\n    .close-modal {\n      font-family: 'Poppins', sans-serif;\n      width: 678px;\n      height: 276px;\n      position: absolute;\n      left: 50%;\n      top: 50%;\n      transform: translate(-50%, -50%);\n      z-index: 9999;\n      box-shadow: 0px 54px 200px rgba(36, 37, 57, 0.2);\n      display: flex;\n      flex-flow: column nowrap;\n      justify-content: flex-start;\n      align-items: center;\n      padding: 35px;\n      border-radius: 8px;\n      background: #fff;\n\n      box-sizing: border-box;\n    }\n\n    .close-modal * {\n      box-sizing: border-box;\n    }\n\n    .close-modal__text {\n      margin: 40px auto 30px;\n      font-weight: 600;\n      font-size: 24px;\n      line-height: 36px;\n      text-align: center;\n\n      color: #242539;\n    }\n\n    .close-modal__button-container {\n      width: 318px;\n      display: flex;\n      flex-flow: row nowrap;\n      justify-content: space-between;\n      align-items: center;\n    }\n\n    .close-modal__button {\n      background: #fff;\n      border: 2px solid #EDEEF3;\n      border-radius: 74px;\n      width: 152px;\n      height: 56px;\n      cursor: pointer;\n      font-weight: 600;\n      font-size: 14px;\n      line-height: 21px;\n      color: #2B2D56;\n      text-transform: uppercase;\n    }\n\n    .close-modal__button--exit {\n      background: #DD3E56;\n      box-shadow: 0px 8px 34px rgba(221, 62, 86, 0.4);\n      color: #fff;\n      border-color: transparent;\n    }\n  `;\n\n  return styles;\n}\n","import {\n  EventSeverity,\n  IConfigError,\n  IHostConfig,\n  InternalEventTypes,\n  TAllEventTypes,\n  TEventListenerDict,\n  WidgetEventTypes,\n  WidgetVariantTypes\n} from './types';\n\nexport function getRandomIntString(): string {\n  try {\n    return String(crypto.getRandomValues(new Uint32Array(1))[0]);\n  } catch {\n    // if `crypto` is not supported, fall back to Math.random\n    // tslint:disable-next-line:no-magic-numbers\n    return String(Math.floor(Math.random() * 10000000));\n  }\n}\n\nexport function normalizeConfigAndLogErrorsOnInvalidFields(\n  config: Partial<IHostConfig>\n): IHostConfig {\n  const errors: IConfigError[] = [];\n  const configCopy = { ...config };\n\n  if (!['desktop', 'mobile', 'auto'].includes(config.variant!)) {\n    configCopy.variant = 'desktop';\n\n    errors.push({\n      fieldName: 'variant',\n      description: 'Invalid value for `variant` config field ',\n      exampleValue: `'desktop'`,\n      severity: EventSeverity.WARNING\n    });\n  }\n\n  logErrors(errors);\n\n  return configCopy as IHostConfig;\n}\n\nfunction logErrors(errors: IConfigError[]): void {\n  if (!errors.length) {\n    return;\n  }\n\n  // tslint:disable:no-console\n  console.group('Config errors');\n\n  errors.forEach(error => {\n    console.group(error.fieldName);\n\n    console.log(error.description);\n    console.log(`Example expected value: ${error.exampleValue}`);\n    console.log(`Severity: ${error.severity}`);\n\n    console.groupEnd();\n  });\n\n  console.groupEnd();\n  // tslint:enable:no-console\n}\n\nexport function initEventListenersDict(): TEventListenerDict {\n  const widgetEventTypes = Array.from(Object.values(WidgetEventTypes));\n  const internalEventTypes = Array.from(Object.values(InternalEventTypes));\n\n  return [...widgetEventTypes, ...internalEventTypes].reduce<TEventListenerDict>(\n    (listenersDict: TEventListenerDict, eventType: TAllEventTypes) => {\n      listenersDict[eventType] = [];\n\n      return listenersDict;\n    },\n    {} as any\n  ) as TEventListenerDict;\n}\n\nexport function countListenersForEvent(\n  listeners: TEventListenerDict,\n  event: TAllEventTypes,\n  internal: boolean = false\n): number {\n  return listeners[event].filter(handler => handler.internal === internal).length;\n}\n\nexport function determineWidgetVariant(config: IHostConfig): WidgetVariantTypes {\n  const mediaQuery = '(min-width: 920px) and (min-height: 630px)';\n\n  if (config.variant === 'mobile' || config.variant === 'desktop') {\n    return config.variant;\n  }\n\n  const isDesktop = window.matchMedia(mediaQuery).matches;\n\n  return isDesktop ? 'desktop' : 'mobile';\n}\n","import bodyScrollLock from 'body-scroll-lock';\nimport { baseWidgetUrl } from './consts';\nimport { delay, doFetchPurchase } from './event-polling';\n\nimport {\n  areUrlsEqual,\n  importFonts,\n  initDOMNode,\n  initWidgetIframeUrl,\n  isCloseModalAlreadyOpen,\n  prepareCloseModalNode\n} from './init-helpers';\n\nimport {\n  IHostConfig,\n  IHostConfigWithWidgetInstanceId,\n  InternalEventTypes,\n  IPurchaseCreatedEvent,\n  IPurchasePollingCredentials,\n  TAllEvents,\n  TAllEventTypes,\n  TEventListenerDict,\n  TWidgetEvents,\n  WidgetEventTypes\n} from './types';\n\nimport {\n  countListenersForEvent,\n  determineWidgetVariant,\n  getRandomIntString,\n  initEventListenersDict,\n  normalizeConfigAndLogErrorsOnInvalidFields\n} from './utils';\n\nexport {\n  IWidgetCloseEvent as WidgetCloseEvent,\n  IWidgetCloseRequestCancelledEvent as WidgetCloseRequestCancelledEvent,\n  IWidgetCloseRequestConfirmedEvent as WidgetCloseRequestConfirmedEvent,\n  IWidgetCloseRequestEvent as WidgetCloseRequestEvent,\n  IWidgetConfigDoneEvent as WidgetConfigDoneEvent,\n  IWidgetEvent as RampInstantEvent,\n  TWidgetEvents as RampInstantEvents,\n  WidgetEventTypes as RampInstantEventTypes,\n  WidgetVariantTypes as RampInstantWidgetVariantTypes,\n  IPurchase as RampInstantPurchase\n} from './types';\n\nexport class RampInstantSDK {\n  public domNodes: {\n    body: HTMLBodyElement | null;\n    iframe: HTMLIFrameElement;\n    overlay: HTMLDivElement;\n    shadowHost: HTMLDivElement;\n    shadow: ShadowRoot;\n  };\n\n  private _widgetIframeUrl: string;\n  private _config: IHostConfigWithWidgetInstanceId;\n  private _listeners: TEventListenerDict = initEventListenersDict();\n  private _isVisible: boolean = false;\n  private _isPollingForSwapStatus: boolean = false;\n  private _purchasePollingCredentials: IPurchasePollingCredentials | null = null;\n\n  constructor(config: IHostConfig) {\n    importFonts();\n\n    this.unsubscribe = this.unsubscribe.bind(this);\n    this.on = this.on.bind(this);\n    this.show = this.show.bind(this);\n    this._handleEscapeClick = this._handleEscapeClick.bind(this);\n    this._dispatchEvent = this._dispatchEvent.bind(this);\n    this._subscribeToWidgetEvents = this._subscribeToWidgetEvents.bind(this);\n    this._on = this._on.bind(this);\n    this._processPurchasePollingLoop = this._processPurchasePollingLoop.bind(this);\n    this._registerSdkEventHandlers = this._registerSdkEventHandlers.bind(this);\n    this._runPostSubscribeHooks = this._runPostSubscribeHooks.bind(this);\n    this._subscribeToWidgetEvents = this._subscribeToWidgetEvents.bind(this);\n\n    const temporaryConfig = normalizeConfigAndLogErrorsOnInvalidFields({\n      variant: 'desktop',\n      ...config\n    });\n\n    const widgetVariant = determineWidgetVariant(temporaryConfig);\n\n    this._config = {\n      ...temporaryConfig,\n      variant: widgetVariant,\n      widgetInstanceId: getRandomIntString()\n    };\n\n    this._widgetIframeUrl = initWidgetIframeUrl(this._config);\n\n    this._registerSdkEventHandlers();\n\n    window.addEventListener('message', this._subscribeToWidgetEvents);\n\n    this.domNodes = initDOMNode(this._widgetIframeUrl, this._dispatchEvent, this._config);\n  }\n\n  public show(): RampInstantSDK {\n    if (!this.domNodes.body) {\n      throw new Error(\"Couldn't find <body> element.\");\n    }\n\n    if (this._isVisible) {\n      throw new Error('Widget is already visible - you can only call this once per instance');\n    }\n\n    this._isVisible = true;\n\n    this.domNodes.body.appendChild(this.domNodes.shadowHost);\n\n    bodyScrollLock.disableBodyScroll(this.domNodes.iframe);\n\n    window.addEventListener('keydown', this._handleEscapeClick, true);\n\n    return this;\n  }\n\n  public on<T extends TAllEvents>(\n    type: T['type'] | '*',\n    callback: (event: T) => any\n  ): RampInstantSDK {\n    this._on(type, callback, false);\n\n    return this;\n  }\n\n  public unsubscribe(\n    type: TAllEvents['type'] | '*',\n    callback: (event: TAllEvents) => any\n  ): RampInstantSDK {\n    if (type === '*') {\n      const allTypes = Object.entries(this._listeners);\n\n      allTypes.forEach(([key, eventHandlers]) => {\n        const filteredHandlers = eventHandlers.filter(l => l.callback !== callback);\n        this._listeners[key as TAllEventTypes] = filteredHandlers;\n      });\n    } else {\n      this._listeners[type] = this._listeners[type].filter(l => l.callback !== callback);\n    }\n\n    return this;\n  }\n\n  public _on<T extends TAllEvents>(\n    type: T['type'] | '*',\n    callback: (event: T) => any,\n    internal: boolean\n  ): void {\n    if (type !== '*' && !this._listeners[type]) {\n      // tslint:disable-next-line:no-console\n      console.warn(\n        `Unknown / unsupported event name - '${type}'. This listener will have no effect.`\n      );\n    }\n\n    if (type === '*') {\n      const allTypes = Object.values(this._listeners);\n      allTypes.forEach(eventHandlers => eventHandlers.push({ callback, internal }));\n    } else {\n      this._listeners[type].push({ callback, internal });\n    }\n\n    this._runPostSubscribeHooks(type, internal);\n  }\n\n  private _subscribeToWidgetEvents(event: MessageEvent): void {\n    if (!event.data) {\n      return;\n    }\n\n    if (!areUrlsEqual(event.origin, this._config.url || baseWidgetUrl)) {\n      return;\n    }\n\n    const eventData = event.data as TWidgetEvents;\n\n    if (\n      !eventData.widgetInstanceId ||\n      eventData.widgetInstanceId !== this._config.widgetInstanceId\n    ) {\n      return;\n    }\n\n    this._dispatchEvent(eventData);\n  }\n\n  private _registerSdkEventHandlers(): void {\n    this._on(\n      WidgetEventTypes.WIDGET_CLOSE,\n      _event => {\n        this.domNodes.shadowHost.remove();\n        this._teardownEventSubscriptions();\n        bodyScrollLock.clearAllBodyScrollLocks();\n      },\n      true\n    );\n\n    this._on(\n      WidgetEventTypes.WIDGET_CONFIG_DONE,\n      _event => {\n        this.domNodes.iframe.classList.add('visible');\n\n        const loader = this.domNodes.overlay.querySelector('.loader-container');\n\n        if (loader) {\n          loader.remove();\n        }\n      },\n      true\n    );\n\n    this._on(\n      InternalEventTypes.WIDGET_CLOSE_REQUEST,\n      _event => {\n        if (this._config.variant === 'mobile' || isCloseModalAlreadyOpen(this.domNodes.overlay)) {\n          return;\n        }\n\n        this.domNodes.overlay.appendChild(prepareCloseModalNode(this._dispatchEvent));\n      },\n      true\n    );\n\n    this._on(\n      InternalEventTypes.WIDGET_CLOSE_REQUEST_CONFIRMED,\n      _event => {\n        this._dispatchEvent({\n          type: WidgetEventTypes.WIDGET_CLOSE,\n          payload: null,\n          widgetInstanceId: this._config.widgetInstanceId\n        });\n      },\n      true\n    );\n\n    this._on(\n      InternalEventTypes.WIDGET_CLOSE_REQUEST_CANCELLED,\n      _event => {\n        const modal = this.domNodes.overlay.querySelector('.close-modal');\n\n        if (modal) {\n          modal.remove();\n        }\n      },\n      true\n    );\n\n    this._on(\n      WidgetEventTypes.PURCHASE_CREATED,\n      (event: IPurchaseCreatedEvent) => {\n        this._purchasePollingCredentials = {\n          apiUrl: event.payload.apiUrl,\n          purchaseId: event.payload.purchase.id,\n          token: event.payload.purchaseViewToken\n        };\n\n        // tslint:disable-next-line:no-floating-promises\n        this._processPurchasePollingLoop(this._purchasePollingCredentials);\n      },\n      true\n    );\n  }\n\n  private _dispatchEvent(event: TAllEvents): void {\n    const { type } = event;\n\n    this._listeners[type].forEach(handler => handler.callback(event));\n  }\n\n  private _handleEscapeClick(event: KeyboardEvent): void {\n    const escKeyCode = 27;\n\n    if (event.key === 'Escape' || event.key === 'Esc' || event.keyCode === escKeyCode) {\n      this._dispatchEvent({\n        type: InternalEventTypes.WIDGET_CLOSE_REQUEST,\n        payload: null,\n        internal: true\n      });\n    }\n  }\n\n  // Event subscriptions aren't cleared so that host can receive a PAYMENT_SUCCESSFUL event\n  // even after the widget has been closed\n  private _teardownEventSubscriptions(): void {\n    window.removeEventListener('keydown', this._handleEscapeClick, true);\n    window.removeEventListener('message', this._subscribeToWidgetEvents);\n  }\n\n  private async _processPurchasePollingLoop({\n    apiUrl,\n    purchaseId,\n    token\n  }: IPurchasePollingCredentials): Promise<void> {\n    this._isPollingForSwapStatus = true;\n\n    while (\n      countListenersForEvent(this._listeners, WidgetEventTypes.PURCHASE_SUCCESSFUL) > 0 ||\n      countListenersForEvent(this._listeners, WidgetEventTypes.PURCHASE_FAILED) > 0\n    ) {\n      // tslint:disable-next-line:no-magic-numbers\n      await delay(1000);\n\n      const purchase = await doFetchPurchase(apiUrl, purchaseId, token);\n\n      if (!purchase) {\n        continue;\n      }\n\n      if (purchase.actions.find(action => action.newStatus === 'RELEASED')) {\n        this._dispatchEvent({\n          type: WidgetEventTypes.PURCHASE_SUCCESSFUL,\n          payload: {\n            purchase\n          },\n          widgetInstanceId: this._config.widgetInstanceId\n        });\n        return;\n      }\n\n      if (purchase.actions.find(action => action.newStatus === 'ERROR')) {\n        this._dispatchEvent({\n          type: WidgetEventTypes.PURCHASE_FAILED,\n          payload: null,\n          widgetInstanceId: this._config.widgetInstanceId\n        });\n        return;\n      }\n    }\n\n    this._isPollingForSwapStatus = false;\n  }\n\n  private _runPostSubscribeHooks(\n    eventType: TAllEventTypes | '*',\n    isHandlerInternal: boolean\n  ): void {\n    /*\n     *  Handles a case where a host subscribes to these events after\n     *  the `PURCHASE_CREATED` event is fired\n     */\n    if (\n      (eventType === '*' ||\n        eventType === WidgetEventTypes.PURCHASE_SUCCESSFUL ||\n        WidgetEventTypes.PURCHASE_FAILED) &&\n      this._purchasePollingCredentials &&\n      !this._isPollingForSwapStatus\n    ) {\n      // tslint:disable-next-line:no-floating-promises\n      this._processPurchasePollingLoop(this._purchasePollingCredentials);\n    }\n  }\n}\n"],"names":["this"],"mappings":"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"}